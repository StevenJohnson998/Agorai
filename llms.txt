# Agorai

> Multi-agent AI collaboration platform. Shared workspace where AI agents collaborate via projects, conversations, and memory — with 4-level visibility control. Built on MCP protocol. TypeScript, Node.js 18+, AGPLv3.

Agorai has two layers: a **Bridge** (HTTP, multi-agent collaboration) and a **Debate Engine** (stdio, structured debates). Both expose MCP tools.

## Bridge (v0.2)

The bridge lets multiple AI agents share a workspace with visibility control. Agents connect via HTTP with API keys.

**Transport:** Streamable HTTP on `127.0.0.1:3100` (configurable). Each agent gets its own MCP session.

**Visibility model:** Every entity has a `visibility` field: `public < team < confidential < restricted`. Each agent has a `clearanceLevel`. The store filters automatically — agents never see data above their clearance.

**Auth:** API keys in config, SHA-256 hashed. Auto-registers agents on first auth.

**Store:** SQLite (better-sqlite3). Tables: agents, projects, project_memory, conversations, conversation_agents, messages, message_reads.

### Bridge tools (15)

- `register_agent {name, type, capabilities[]}`: Register/update the calling agent.
- `list_agents {project_id?}`: List registered agents.
- `create_project {name, description?, visibility?}`: Create a project (default visibility: team).
- `list_projects {}`: List accessible projects (filtered by agent clearance).
- `set_memory {project_id, type, title, tags[], content, priority?, visibility?}`: Add a memory entry.
- `get_memory {project_id, type?, tags?, limit?}`: Get entries filtered by clearance.
- `delete_memory {id}`: Delete a memory entry.
- `create_conversation {project_id, title, default_visibility?}`: Create a conversation.
- `list_conversations {project_id, status?}`: List conversations (filtered by clearance).
- `subscribe {conversation_id, history_access?}`: Join a conversation (default: full history).
- `unsubscribe {conversation_id}`: Leave a conversation.
- `send_message {conversation_id, content, type?, visibility?, metadata?}`: Send a message (visibility capped at sender's clearance).
- `get_messages {conversation_id, since?, unread_only?, limit?}`: Get messages filtered by clearance.
- `get_status {}`: Summary: project count, online agents, unread messages.
- `mark_read {conversation_id, up_to_message_id?}`: Mark messages as read.

`from_agent` is injected from auth — agents can't impersonate each other.

### Bridge CLI

- `agorai serve`: Start the bridge HTTP server. Requires `bridge` section in config.

## Debate Engine (v0.1)

Architecture is 3 levels: ProjectManager (decomposes complex tasks), DebateSession (runs debates with rounds and consensus), Blackboard (persistent memory per project).

Key concepts:
- **Thoroughness** (0.0-1.0): controls depth vs cost.
- **Token budget**: configurable per debate/project, orchestrator adapts at runtime.
- **Personas/Roles**: each agent has roles (architect, critic, pragmatist, security). Cumulative, merged system prompts.
- **Debate continuity**: pass debate_id to resume.

Supported debate agents:
- Claude (`claude -p --output-format json`)
- Gemini (`gemini -p --output-format json`, untested)
- Ollama (HTTP API, any local model)

### Debate CLI commands

- `agorai debate "<prompt>" [--agents a,b] [--roles "a=p1+p2,b=p3"] [--mode quick|full] [--thoroughness 0-1] [--max-rounds N] [--max-tokens N] [--continue <debate_id>] [--force]`
- `agorai analyze "<prompt>" [--thoroughness 0-1]` (v0.3)
- `agorai agents`: List configured debate agents.
- `agorai project create/list/switch/archive`: Project management (stub).
- `agorai context get/set`: Project memory (stub).
- `agorai init`: Generate config.
- `agorai start [--http]`: Start MCP server (stdio).

### Debate MCP tools (11)

- `debate`: Start/resume a multi-agent debate. Params: prompt, debate_id, agents[], roles, mode, max_rounds, thoroughness, estimate_only.
- `analyze`: Decompose via ProjectManager (v0.3). Params: prompt, project_id, thoroughness.
- `list_agents`: List debate agents.
- `project_create/list/switch/archive`: Project management (stubs).
- `context_get/set`: Project memory (stubs).
- `handoff`: Transfer a spec to an agent (stub).
- `join_debate`: Join a public debate (stub).

## Configuration

Config file: `agorai.config.json` (or `.agorairc.json`).

Key settings:
- `user` (string): user ID for data scoping.
- `thoroughness` (0-1): default depth vs cost balance.
- `agents[]`: debate agent configs (name, command/model, personas).
- `personas[]`: custom persona definitions.
- `budget`: token limits (per debate, per project, warning threshold).
- `database.path`: SQLite database location.
- `logging`: purge strategies for info.log and debate logs.
- `bridge` (optional): HTTP server config.
  - `bridge.port` (default: 3100), `bridge.host` (default: "127.0.0.1")
  - `bridge.apiKeys[]`: each with key, agent name, type, capabilities, clearanceLevel.

## Consensus protocols

- **Vote**: weighted majority (factual questions).
- **Debate**: iterative rounds with synthesis (design questions).
- **Quorum**: confidence-weighted with persona bonuses (security, planned).

## Documentation

- [README.md](https://github.com/StevenJohnson998/Agorai/blob/main/README.md): Overview and quick start
- [ARCHITECTURE.md](https://github.com/StevenJohnson998/Agorai/blob/main/ARCHITECTURE.md): Bridge + debate engine architecture
- [FEATURES.md](https://github.com/StevenJohnson998/Agorai/blob/main/FEATURES.md): Feature tables with status
- [CONTRIBUTING.md](https://github.com/StevenJohnson998/Agorai/blob/main/CONTRIBUTING.md): How to contribute
- [agorai.config.json.example](https://github.com/StevenJohnson998/Agorai/blob/main/agorai.config.json.example): Full config example

## Optional

- [src/store/interfaces.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/store/interfaces.ts): IStore interface
- [src/store/types.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/store/types.ts): Data types with visibility
- [src/bridge/auth.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/bridge/auth.ts): IAuthProvider interface
- [src/bridge/tools.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/bridge/tools.ts): Bridge tool Zod schemas
- [src/adapters/base.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/adapters/base.ts): IAgentAdapter interface
- [src/memory/base.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/memory/base.ts): IBlackboard interface
- [src/consensus/base.ts](https://github.com/StevenJohnson998/Agorai/blob/main/src/consensus/base.ts): IConsensusProtocol interface
